# 常用规范和实现方法

## 界面尺寸调整

### 手动调整控件尺寸和位置

一个程序中所有相同类型的控件都应当尽量保持一致的风格和统一的大小。尤其是在同一界面上的一组相同的控件，更应当保持一致。

![](images/image588.png)

图 .15包括一组按钮的VI界面

图 10.15是一个VI的前面板，在这个界面上放置了一组按钮。为了保持界面的整洁，这组按钮应当大小统一，排列整齐，并使用相同的字体。

LabVIEW提供了几个用来整理界面控件位置和大小的工具，这几个工具在编辑界面时是经常要用到的。它们位于VI的工具条上，分别称之为"文本设置"、"对齐对象"、"分布对象"、"调整对象大小"。图 10.15列出了这几个工具按钮的主要功能。字体调整按钮用于修改界面上文本的字体、大小、颜色、对齐方式等。它右侧的四个工具按钮分别用于对齐控件、调整控件间距、调整控件大小以及调整控件前后的顺序。

我们首先要把界面上的按钮调整成同样的大小。先选中所有的控件，然后根据需要点击"调整对象大小"工具钮的相应按钮。如按"最大宽度"按钮，则所有的控件都被设置为与最宽的控件相同的宽度（图 10.16）。

![](images/image589.png) ![](images/image590.png)

图 .16使用最大宽度控件调整控件的宽度

也可以选中全部控件后，使用"设置宽度和高度"按钮。点击这个按钮后，会弹出一个对话框，设置控件长宽的具体数值（图 10.17）。

![](images/image591.png) ![](images/image592.png)

图 .17设置宽度和高度工具

VI工具条上其它几个工具的使用方法与调整控件大小按钮的使用方法类似，就不重复解释了。

利用调整控件位置和间距的工具，以及字体调整工具，把控件排列整齐。排列整齐的界面看上去就顺眼多了（图 10.18）。

![](images/image593.png)

图 .18排列整齐的界面

### 设计可调节大小的程序界面

程序的界面应该有多大呢？如果程序可能会被多个用户使用，就难免会运行在各种分辨率的屏幕上。如果界面太大，低分辨率的显示屏就无法完全显示；如果界面太小，对于高分辨率显示屏来说又是一种浪费。从用户的角度考虑，程序的界面尺寸最好是可调的，用户可以选择适合计算机屏幕的任意大小的界面。为了界面显示的协调，程序界面尺寸发生变化时，界面上的控件各自的大小和位置也必须随之调整。

控件跟随界面大小变化有两种方式。一种是控件大小也需要跟随调整的：一些显示数据量较大的控件，比如波形显示控件、表格、大文本框等，通常是界面的主要控件，需要随之调整尺寸以获得尽量大的显示区域；而有些控件的尺寸可以是固定的，比如按钮，选择框等控件。界面尺寸变化时，虽然不需要调整尺寸，但它们的位置可能需要调整，以获得最佳的界面布局。

### 窗格和分隔栏

一般来说，每个VI有一个前面板（Panel），每个前面板又可以是由多个窗格（Pane）组成的。默认情况下，新建一个VI，这个VI的前面板是由单个窗格组成的。由于大多数情况，每个面板只有一个窗格，也往往就忽略了窗格的存在。但是在编程时，一定要意识到：LabVIEW程序中的控件是摆放在窗格上，而不是前面板上的；窗格才是摆放在前面板上的。

使用分隔栏可以在前面板上分割出更多的窗格来。分隔栏在控件选板 " \[xx风格] ->容器"中。分隔栏有横、竖之分，可以把前面板按照不同的方向分成两块。控件无论被放在哪个窗格里，只是界面的外观不同，对程序功能都没有影响。

当前面板的大小改变时，分隔栏也可以跟随着移动。在分隔栏的鼠标右键菜单中有一项"调整分割栏"，可以用来设置状态栏跟随面板的哪个边沿一起移动，或是按比例移动。

![](images/image594.png)\
图10.19 设置分隔栏移动方式

分隔栏的右键菜单最后两项"左窗格""右窗格"(或"上窗格""下窗格")，用来设置分隔栏两侧窗格的一些属性。比如，界面划分成窗格后通常不需要显示窗格内的拖动条，可以在子菜单中禁止其显示。

分隔栏的属性也可以在运行状态下通过程序来设置。在程序框图上分隔栏虽然没有控件那样的接线端，但可以使用右键菜单创建它的引用、属性节点和调用节点，并且在程序中使用它的属性以及方法。比如图10.20中的程序就是从左到右挪动图10.19状态栏的位置。

![](images/image595.png)\
图10.20 使用分隔栏的位置属性调整分隔栏位置

在程序运行时，用户仍然可以在界面上移动分隔栏。若不希望用户改变分隔栏位置，可以在分隔栏的右键菜单中选中"锁定"，这样，分隔栏的位置就被锁定了。

分隔栏没有隐藏属性。若希望程序运行时看不到分隔栏，可以通过改变分隔栏颜色来达到隐藏的目的。首先，把分隔栏的风格改为"经典"，然后把它的颜色染成与程序框图相同，程序运行时就看不到分割栏了。顺便提一句，分隔栏两侧的窗格是可以有不同背景色的。

窗格也是没有隐藏属性的。若在程序运行时需要隐藏某个窗格，可以调整它周围分隔栏的位置，让这个窗格缩起来就行了。

### 编程调整控件的位置尺寸等属性

如果需要在程序运行时调整界面尺寸，一个有效的方法是动态调整控件的尺寸与位置。当程序接收到"窗格大小"这一事件后，根据新的界面的尺寸，重新计算每个控件的位置和大小。

比如图10.21所示的程序界面包含一个波形图控件和一个停止按钮。

![](images/image596.png)\
图10.21 包含一个波形图控件和一个停止按钮的VI前面板

当用户改变界面尺寸时，希望停止按钮始终停靠在界面右下角，而波形图控件则撑满剩下的界面空间。这些变化都可以通过编程来设置，示例程序如图10.22。每当界面发生尺寸发生变化，程序就重新读取界面当前的宽度和高度，再根据这两个数值计算每个控件应当所在的位置和大小。图10.22中的程序，调整界面布局的代码被放在了一个"调整控件尺寸"的用户事件分支中，而不是直接在"窗格大小"这一事件分支中处理，这是因为程序可能有多处需要调整界面布局，比如程序在初始化和"窗格大小"事件发生时都需要调整界面布局。解决办法就是：把调整界面布局的代码被放在"调整控件尺寸"的用户事件分支中，而当程序初始化和"窗格大小"事件发生时，都抛出一个"调整控件尺寸"事件，程序便跳转到这一分支来调整界面布局了。这样避免了程序在多处使用同样的调整界面布局代码。

![](images/image597.png)\
图10.22 调整控件位置和尺寸的程序

使用编程的方法调整控件布局，使其符合变化的界面尺寸，其优点是调整精确稳定。有些控件，比如仪表盘控件，只能通过这种编程的方式才能准确调整其大小。编程方法的缺点是调整较为繁琐。对于比较简单的界面，可以考虑使用分隔栏帮助界面布局，省去编程的繁琐。

### 等比例改变所有控件的尺寸

如果程序的界面很简单，只包含一个窗格，则可以在VI属性中设置 "按窗口大小缩放所有控件尺寸"。这样，当界面尺寸变化时，界面所有的控件都将按相应的比例调整自身大小。

![](images/image598.png)\
图10.23 VI的"按窗口大小缩放所有控件尺寸"属性

这样设置之后，效果是整个界面按比例缩放，所有的控件都一起变化。但是，这样的缩放并不太精确。反复多次调整界面尺寸后，假如界面再回复到原始的大小，会发现有些控件尺寸可能有少许改变。这是因为前面板的尺寸和控件的尺寸都只能是整数，这样每次调整界面后，控件与前面板尺寸的比例都会有所变化。也就是说每次界面调整都会引入误差，误差累积还是比较明显的。

### 仅改变一个主控件的尺寸

在大多数的程序界面上，往往只需要有一个能够缩放的控件撑满屏幕就可以了。其它的控件没有必要调整大小，只要它们的布局整齐不乱就行。

比如对于只包含有一个波形图控件和一个停止按钮控件组成的界面，它只需要波形图随界面尺寸的调整而变化。那么只要在这个控件右键菜单中选中它的"随窗格缩放"属性就可以了。但每个界面窗格只允许有一组控件被设置成"随窗格缩放"。

被设置成这一属性的控件四个边沿的延长线都被深色标注出来了。当界面尺寸被调整时，四条深色直线到其最近的VI前面板的边沿的距离是不变的，只有被这个四条深色直线包裹出来的矩形区域的尺寸会随界面一起变化。这样一来，可以保证程序的主控件随界面尺寸变化，而其它的控件位置保持稳定。

![](images/image599.png)\
图10.24 设置控件"随窗格缩放"

若主控件有多个，比如说界面上有两个同等重要的波形控件，那么只要把两个主控件组成一组。由多个控件绑成的组，在外观布局上的行为属性与单个的控件是类似的。把这个组设置为"随窗格缩放"，这一组的控件就可以一起随界面尺寸变化了。

![](images/image600.png)\
图10.25 将多个控件设为一组

当界面尺寸发生变化时，图10.25所示的"开始"和"停止"按钮之间的距离也会变动，因为它们一个靠近边界线左端，另一个靠近右端。若需要这两个按钮的相对距离保持不变，也把它们绑成一组就可以了。

### 借助分隔栏调整控件的位置与尺寸

对于比较复杂的界面，同样也可以仅仅借助于分隔栏调整控件的尺寸和位置。用图10.26这样一个比较复杂的界面为例：

![](images/image601.png)\
图10.26 一个由多个控件组成的复杂界面

这个界面包含五个控件，假设界面要求如下：水箱、油箱、波形图三个控件需按比例随界面尺寸调整，但它们三个控件之间的距离，以及它们距离界面边框的距离不能变化；信息框的长度随界面调整，但高度不变；停止按钮尺寸保持不变，且始终在界面右下角。

可以使用分隔栏来定位每个控件的位置。为了方便在编辑时调整控件尺寸，以及确保控件尺寸和位置在多次调整界面大小后仍然准确，可以设置较多的分隔栏。原则是让每个需调整尺寸的控件都有一个可以撑满的窗格。 之后，在控件的右键菜单中选择"将控件匹配窗格"，让它们的尺寸始终与窗格保持一致。

![](images/image602.png)\
图10.27 利用窗格分割界面

水箱、油箱、波形图、信息四个控件都需要设置为撑满窗格，而停止按钮由于大小不变，不需要有此设置。

这个例子是比较极端的情况，一般来说并不需要设置这么多的分隔栏，只要能保持每个窗格内只有一个跟随界面调整的控件就可以了。

界面上各个控件变化方式不同，全在于分隔栏对齐方式的设置。图10.28显示了分隔栏对齐方式的设置：

![](images/image603.png)\
图10.28 每个分割栏的对齐方式

实际上，用户不会希望在界面上把分隔栏显示出来，可以参考10.2.1.3节介绍的方法将其隐藏。

### 程序\[调节界面

1. **有些控件不能改变尺寸**LabVIEW中并非所有的控件都可以调整其大小。大多数尺寸固定的控件都是用来给子VI输入输出参数的，不会用到用户界面上。但也有一些会用于界面，尤其是一些系统风格的控件，比如单选框、复选框控件等。

![](images/image604.png)\
图10.29 几种不可改变尺寸的控件

&#x20;

1. **有些控件必须保持长宽比**大多数LabVIEW控件可以分别设置它们的高度和宽度。但有一些控件，比如仪表盘、旋钮等，它们的形状是固定的，只能是正圆。也就是无论大小如何，长宽始终保持一比一。

对于这样的控件是不能使用"根据窗格缩放对象"、"将控件匹配窗格"的，LabVIEW对于这类控件大小的自动调整并不准确。对于它们，只能使用编程的方式调整尺寸。

![](images/image605.png)\
图10.30 必须保持长宽比的控件

&#x20;

1. **界面最小尺寸**无论采用哪种方式调整界面布局，最好都为界面设置一个最小尺寸。因为任何控件都不可能无限小，所以整个界面缩得太小对于用户也是没有意义的。VI前面板的最小尺寸也就是程序界面的最小尺寸，这一设置可以在VI的属性对话框中找到。

![](images/image606.png)\
图10.31 设置界面的最小尺寸

## 应用程序的退出按钮

LabVIEW的VI主面板窗口标题栏右上侧有一个红叉，是用于关闭该VI的窗口的。尽管已经有了这个关闭窗口按钮，但是程序界面上还是应该有一个用于退出程序或关闭界面的命名为"取消"、"退出"、或"关闭"等的按钮。这是为了与用户习以为常的对话框保持一致。不论是Windows系统的对话框，还是LabVIEW中的对话框，都有用于退出或关闭对话框的按钮。一般来说，用户总是会习惯性地在界面上寻找关闭对话框的按钮的。

同时还应注意，在程序中需要对用户点击标题栏红叉关闭界面的操作进行必要的处理。有些人直观的认为，既然窗口关闭了，VI中的代码也应当停止执行，其实不然。应用程序中弹出的对话框通常是应用程序中的一个子VI，点击对话框窗口右上方的红叉，虽然关闭了VI的前面板，但并不会把这个子VI移除出内存，也不会自动停止VI的运行。如果VI中有循环结构的话，它可能还会运行一段比较长的时间，甚至因为不能满足循环停止的条件（比如，只有点击对话框上的某按钮才能停止循环，而这时对话框界面已被关闭，永远无法点击这一按钮），而永远运行下去，直到关闭计算机。笔者曾经处理过一些VI程序，点击了它们界面上的某些对话框的关闭窗口按钮（红叉）后，VI程序就会对界面的操作停止反应，问题就出现在这里。

界面程序通常是使用事件结构编写的，在<本VI>事件源中有专门的关闭VI前面板事件。在程序中，一定要对这一事件进行处理。图 10.22显示的就是用户点击界面上的停止按钮、或点击关闭窗口按钮后的事件处理程序框图。程序包括了程序终止前的预处理、关闭界面并终止程序。

![](images/image607.png)

图 .22关闭程序窗口，需要相应地终止程序运行

在有些程序中，若随意关闭了面板或对话框，可能会引发严重问题。这时，当用户点击界面标题栏关闭窗口按钮时，程序需要给用户一个提示框，让用户确认。只有在用户确认要关闭程序时，才真正关闭程序，以避免误操作引发更大的麻烦。

使用"前面板关闭？"过滤型事件就可完成这样的功能（图 10.23）。当用户点击了红叉，先弹出对话框询问用户，当用户点击确认后，才真正关闭程序（图 10.24）。

![](images/image608.png)

图 .23利用过滤型事件，弹出确认对话框

![](images/image609.png)

图 .24确认退出的对话框

## 菜单

运行一个VI，在主面板菜单栏上显示的是LabVIEW设置的默认菜单。这些菜单对于LabVIEW应用程序来说，也许毫无用处。程序通常需要有自己的菜单项。

创建程序自己的菜单非常简单，LabVIEW带有专门的菜单编辑器。在界面VI的菜单中选择"编辑->运行时菜单"就可以调出菜单编辑器（图 10.25），用以创建"自定义"菜单。

菜单编辑器的界面比较简单，根据界面上的菜单、工具条以及帮助文档，读者可以自行编辑所需的自定义菜单。

![](images/image610.png)

图 .25菜单编辑器

保存编辑好的菜单，再次运行界面VI，界面上出现的将是自定义的菜单（图 10.26）。

![](images/image611.png)

图 .26自定义菜单

创建完菜单之后，还必须在程序中添加响应菜单操作的程序代码。在点击自定义菜单时，LabVIEW将产生一个"菜单激活？"事件；在选择自定义菜单中的菜单项时，LabVIEW会产生一个"菜单选择（用户）"事件。有关菜单的事件都位于<本VI>事件源。在程序的事件结构中捕获这一事件，然后为其添加相应的代码即可。比如图 10.27中的程序用于改变"显示数据"菜单项前的打勾状态。

菜单函数位于"编程->对话框与用户界面->菜单"子函数选板上。

![](images/image612.png)

图 .27响应菜单按下的程序

## 控件快捷菜单

程序在运行过程中，鼠标右击某个控件，将弹出LabVIEW的默认控件快捷菜单（图 10.27）。这个快捷菜单往往也是不适用于应用程序的，那就需要为控件设置自定义右键弹出菜单。

![](images/image613.png)

图 .28控件运行时的右键弹出菜单

选择控件右键菜单"高级->运行时快捷菜单->编辑"，将弹出"快捷菜单编辑器"。它的编辑方法与界面菜单栏相类似。保存该菜单，运行VI，右键点击该控件，弹出的将是自定义的快捷菜单。同样，也需要在相应控件的"快捷菜单激活？""快捷菜单选择（用户）"事件框中，编写对应的实现其功能的程序。

图 10.29的例子中，我们为界面上的"停止"按钮设定了一个弹出菜单，这个菜单上只有一个条目"变换颜色"。每次点击这一菜单项，按钮就会改变显示颜色。

![](images/image614.png) ![](images/image615.png)

图 .29通过右键菜单改变控件的颜色

在编调控件的右键菜单事件时需要注意的是，"快捷菜单激活？"事件框中的菜单引用仅在该框内有效。

## 使用键盘操作界面

尽管鼠标是最主要的操控程序界面的工具，但不能排除有些用户还习惯于使用键盘来控制程序界面。为了照顾用户的操作习惯，在设计程序界面时应当使得所用控件都可以通过键盘上的按键来访问。

最常见的键盘操作方式是使用Tab键在界面的控件间切换。在使用Tab键切换控件的焦点时，应当按照从左到右、从上到下的顺序进行。这一顺序可以使用菜单"编辑->设置Tab键顺序"进行修改（图 10.30）。然后，按动√或×，以确认或放弃选择的新顺序。

![](images/image616.png)

图 .30设置Tab键顺序

如果某一控件不需要使用Tab键选中，可以在控件的属性对话框中"快捷键"一页上选中"按Tab键时忽略该控件"。

有些特殊控件，比如"确定"、"取消"、"退出"这类的按钮，在界面操作中是常常用到的，可以为他们设置专门的选中或切换快捷键。这一设置同样位于控件的属性对话框中"快捷键"一页上（图 10.31）。

![](images/image617.png)

图 .31设置控件的快捷键

## 用户自定义控件

虽然LabVIEW已经提供了种类繁多的控件，但肯定还是无法满足某些编程者的需求。开发者有时会希望能够自制一些外观特殊的控件，这需要制作用户自定义控件。

如果需要创建外观非常精美的控件，它的难度主要在于创意和美术设计方面，而非编程方面。制作这样的控件，首先要准备好相应的素材，即一些漂亮的图片。然后用这些漂亮图片代替LabVIEW控件原有的图片即可。

### 创建一个自定义控件

制作自定义控件，常见方法是在一个已有的LabVIEW控件上进行改造。一般来说，几乎不可能完全从空白开始，凭空创建出一个与LabVIEW已有控件毫不相关的控件来。比如说，我们要创建用户自定义后退按钮，可以把LabVIEW已有的按钮作为模板，在其基础上进行改造。

创建自定义控件，首先要创建一个.ctl文件。创建.ctl文件有两种方法。可以从菜单项"文件->新建->自定义控件"开始。这样创建出来的是一个空白.ctl文件，在此.ctl文件界面上添加一个LabVIEW自带的按钮控件，再进行修改就可以了。此外，还可以右键点击前面板上的某一控件，选择"高级->自定义"即可新建一个带有这一控件的.ctl文件（图 10.32）。

![](images/image618.png)

图 .32以某一控件为模板，创建自定义控件

.ctl文件的界面与VI前面板看起来非常相似。在它的界面上只允许放置一个控件，缺少控件或超过一个控件，工具栏上就会出现错误提示标志（图 10.33）。在它的面板上可以放置多个装饰图形或标签文字。.ctl文件没有程序框图，因此它只能定义控件的外观或数据类型，不能定义控件的行为。

![](images/image619.png)

图 .33当面板上出现两个控件，工具栏出现错误提示

### 自定义控件的组成部分

.ctl文件有三种类型："输入控件"、"自定义类型"和"严格自定义类型"（图 10.34）。在工具栏的"控件类型"下拉菜单中可以选择其类型。其中，"输入控件"是指一般的自定义控件，它用于自定义控件的外观。而"自定义类型"和"严格自定义类型"除了可以定义一个控件的外观，它们最主要的用途还在于定义一个控件的数据类型。这一章主要讨论定义控件的外观，下一章再介绍自定义数据类型。所以这里仅介绍"输入控件"类型的自定义控件。

![](images/image620.png)

图 .34选择控件类型

控件类型下拉框左面是一个显示为扳手或镊子图形的按钮，按动它，界面可以在"编辑模式"和"自定义模式"间切换。在编辑模式下，可以修改控件的尺寸、颜色等属性（这与在VI的前面板上直接修改控件属性相同）；在自定义模式下，则可以把控件的各个部分拆解开来，进行更细致的修改，从而彻底改变控件的外观。

在自定义模式下，控件每个可拆分的部分都被一个白色框所包裹，以利于区分。不同的控件，其组成成份完全不同。比如，最简单的按钮，由标签、按钮主体部分、布尔文本三部分组成；而滑动杆控件则复杂得多，它由标签、左移动按钮、右移动按钮，左侧背景颜色、右侧背景颜色、滑动杆、标尺、背景边框、数字显示、单位标签等多个部分组成（图 10.35）。

![](images/image621.png) ![](images/image622.png)

图 .35自定义模式下可拆解控件的组成部分

### 修改控件组成部分

假如，要把控件做成类似浏览器的回退按钮模样。其外观图片为：![](images/image623.png)

在修改自定义控件之前，先准备好需要使用的图片文件。

最简单的方法是用图片来代替控件原有的布尔文本。在自定义模式下，右键点击按钮的布尔文字部分，选择"从文件导入..."（图 10.36），再选择已准备好的图片文件。这样，控件中原有的部分，就被导入的图片替代了。

![](images/image624.png)

图 .36导入图片，替代控件已有部分

使用这种方法做出来的按钮如图 10.37所示，它看上去类似Windows 2000之前的风格，有些落伍了。

更好的方式不是把圆形图片贴在方形按钮上，而是用导入图片替代模板控件的按钮主题部分，直接做成一个圆形的按钮。

![](images/image625.png)

图 .37用导入图片替代布尔文字部分后的自定义控件效果

具体操作如下：

按钮是圆形的，而所有图片文件都是矩形的。为此，要求矩形图片上只有一个圆形图案，而圆形之外的部分是透明的。常见的图像文件中，png文件对透明支持得最好。所以，需要采用png文件制作按钮素材。

按钮的主题部分需要四张图片分别表示四种不同的状态：真、假、真至假、假至真。但如果是一个触发型按钮，那只有两种状态：正常状态与鼠标按下状态。所以，在这个例子中只需要两幅图片：未按鼠标时，采用一种图片；鼠标按下时，采用另一幅颜色较深的图片。

在自定义模式下，鼠标右键点击控件的主体部分，可以看到"从剪贴板导入图片"、"从文件导入"等选项。利用这些选项可以把按钮控件当前状态的外观图片替换掉。通过鼠标右键菜单的"图片项"可以切换到按钮的其它状态，再把其它几个状态的图片都一一替换掉（图 10.38、图 10.39）。

![](images/image626.png)

图 .38选择按钮主体部分不同的图片项

![](images/image627.png)

图 .39导入新图片后按钮的四个图片项

这个自定义控件的机械动作需要被设置为"释放时触发"。在应用程序中使用它的效果如图 10.40所示。（其中"布尔2"正在被鼠标按下）

![](images/image628.png)

图 .40圆形按钮的使用效果

## 组合控件

复杂的控件常常可以由一些简单控件组合而成。

### 1 LabVIEW控件与WPF控件的比较

把几个独立的控件组合起来使用，在不同编程语言中，采用了不同的策略，它们各有优缺点。首先分别比较一下WPF和LabVIEW如何组合简单控件。

WPF是.NET中编写程序界面的一套体系，是目前比较先进的一种界面编程体系。微软提出WPF的构想应该是希望把程序的界面和运行逻辑部分完全分开。这样，可以有专业美工设计程序界面；而程序员则专心程序功能的编码。WPF的界面设计使用了它自己专门的记录方式------XAML语言。这是一种类似XML格式的文本语言。在程序进行编译的时候，编译器再把XAML代码编译成.NET的中间代码。这种方式与LabVIEW是类似的：界面与程序代码采用了两套不同的表现方式。

LabVIEW的界面设计简单直观。WPF似乎还不成熟，在可视化编辑方面尚有改进之处。最严重的问题是，一旦界面较为复杂，Visual Studio的界面编辑器就无法对其进行解析显示。也就是说，完全失去了可视化编辑的功能。笔者正在进行的一个项目，包括上百个XAML文件，其中超过7成的文件都无法被界面编辑器显示出来，仍需手工修改XAML文本。修改完成后，需要运行程序方能看到修改的效果。

再有，程序界面很少是静态的，界面上常常有一些元素在程序运行时会跟随某些数据的改变而变化。也就是说，WPF上总会有一些控件是和程序中某些数据绑定起来的。对LabVIEW而言，即便在编辑状态下，控件也可以拥有数据。因此，程序员在编辑状态下就可以看到程序运行后的控件状态。而WPF没有这一功能，程序只有在运行时才拥有数据，而在编辑状态下，所有数据都是空的。这样一来，在WPF界面编辑器上看到的界面很可能与程序运行时是完全不同的。

界面上的基本元素是控件，LabVIEW与WPF由于面向的对象不同，在提供什么样的控件这个问题上采用了完全不同的策略。WPF面向通用编程，是给专业程序员用的，它侧重功能的强大与编程的灵活性。WPF自带的界面控件种类并不多，但是程序员可以方便地把它们组合起来，实现各种界面风格，完成各类复杂功能。而早期的LabVIEW主要应用于测控领域，LabVIEW拥有众多的非专业程序员客户。因此LabVIEW更侧重控件的易用性：它提供了大量自带的控件，每个控件可供修改的属性有限。使用这些控件是很容易的，拖到VI前面板上就可以了；如果想使用某种LabVIEW尚未提供的控件，则难度极高。

当今，LabVIEW的应用已远超出早期预想的范围。相当一部分LabVIEW的使用者都是专业程序员，他们对于功能和灵活性的要求越来越高，因此LabVIEW近期的几个版本也在这方面做了较大改进。比如，增加了项目管理功能，支持面向对象等。XControl（详见本书12.2节）便是专门为补偿LabVIEW自带控件功能不足和灵活性不足而设计的新功能。但XControl使用起来过于复杂了，不如WPF的机制更加合理。

WPF中的控件几乎都可以作为容器再容纳其它控件。比如说按钮控件，WPF只提供一个按钮框架以及按下按钮相关的方法和事件。如果用户希望按钮上附加一张图片，就可以在按钮控件里面再嵌入一个图片控件；如果希望按钮上再有一行文字，那就在按钮中再放入一个文本框控件；如果还需要其它功能，再放入其它相应控件即可。但LabVIEW的控件中，除了有限的几个以外，都不能嵌套使用。LabVIEW仅仅提供了可带图片和带文字的按钮，如果还需要附带其它功能，那只能使用复杂的XControl了。

以一种界面常用到控件------表格为例。假如用户要求的表格控件包含有两列，第一列的每个元素都是一个按钮，第二列每个元素是一个下拉框。使用WPF编程非常容易，直接把按钮和下拉框嵌入基础的表格控件就行了；而使用LabVIEW，是不能直接把按钮和下拉框嵌入基础表格控件，就不得不通过软件编程的方法，使各个按钮和下拉框控件在界面上移来移去，让它看上去好像在列表框里一样。当然，与用WPF相比，这种编程的方法复杂一些。

LabVIEW中也有一些和WPF控件的性质类似的控件，比如选项卡控件。用户可以随意把一个按钮或者灯泡之类的任意控件放到选项卡控件的某一页上去，组合起来使用。

### 2 列表框与下拉菜单列表控件组合使用

在这一节，举一个例子来说明如何在程序中通过移动控件的方法，形成如同组合控件的功能。

表格是一种常见的界面控件，本例中，用户需要表格中某一列的内容只在有限的范围内选择。实现这样的表格，可以用一个下拉菜单列表控件给用户提供选择内容，以限定用户输入内容的范围，防止填错。比如图10.47所示的一个程序界面，界面上表格的第二列需要由用户填写，并且只能在"甲""乙""丙""丁"四个值中选择。当用户点击表格第二列上某个单元格时，该单元格会变成一个下拉菜单列表控件，让用户从中选取一个值。

![](images/image629.png)\
图10.47 表格单元格为下拉菜单列表控件

如图10.48所示，实现这样的表格需要把两个控件组合起来，一个是"列表框"控件，一个是"下拉菜单列表"控件。

![](images/image630.png)\
图10.48 复杂表格程序的前面板

程序需要监视列表框控件的"鼠标按下?"事件。若用户点击了列表框控件，程序首先要检查是否点击了列表框第二列（"种类"列）的单元格；如果是，则设置下拉菜单列表控件的尺寸与该单元格大小相等，并调整下拉菜单列表控件的位置，让它覆盖在被点击的单元格上。这样，用户的感觉就完全如同这个单元格变成了一个下拉菜单列表控件。这段程序见图10.49

![](images/image631.png)\
图10.49 处理列表框控件点击的程序代码

若这时用户从下拉列表框上选取了一个值，则应当把用户选取的值作为单元格新的值；并且调整它的位置，把它移至所显示的界面之外。

![](images/image632.png)\
图10.50处理下拉菜单列表控件值改变的程序代码

这个程序还需要考虑何时隐藏下拉菜单列表控件：比如当用户鼠标点击列表框其它列，或点击在列表框之外的时候，就应当把下拉列表控件隐藏起来。

![](images/image633.png)\
图10.51 隐藏下拉菜单列表控件的代码
