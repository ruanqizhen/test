# 动态创建和修改VI

## VI 脚本授权

前文提到的VI脚本相关的属性和方法都是不需要特别授权的，在LabVIEW专业版中直接就可以使用。还有一些更加强大的VI脚本功能在默认情况下并没有打开。比如，需要使用VI脚本创建新的VI或VI上的控件、函数等，或者需要修改VI的程序框图等功能。

从LabVIEW
2010开始，打开这些高级功能的开关被放置在LabVIEW的选项对话框中。在选项中的VI服务器页面，可以看到VI脚本选项，只要选中这一选项，VI脚本功能就被激活了。

![](images/image429.png)\
图6.31 在LabVIEW的选项对话框中打开VI脚本功能

在激活了VI脚本的授权之后，"应用程序控制"函数选板上会多出一个名为VI脚本的子选板（图
6.32）。这个子选板中有5个新增加的函数。第一个函数（新建VI）用于创建新的VI；第二个函数"打开VI对象引用"用于通过标签打开VI上的对象（比如控件、函数等。利用VI前面板的"控件\[\]"、程序框图的\[节点\]等属性，也可以实现类似的功能）；第三、四个函数"新建VI对象"用于创建新的VI上的对象；最后一个函数"遍历查找图形对象"用于得到一个VI上某一类的对象的所有引用。这一功能与前文（图6.10）提到的Get
Control.vi的功能非常类似。由于VI脚本函数选板已经提供了"遍历查找图形对象"VI，在程序里就可以使用这个VI替代Get
Control.vi。

![](images/image430.png)\
![](images/image431.png)

图 6.32授权后才能使用的VI脚本函数

激活VI脚本的授权后，可使用的属性和方法也会增加很多。图
6.33是属性节点选择VI属性的菜单，其中"包含已编译代码"、"程序框图"、"程序框图窗口"等属性都是在激活授权后出现的。这些授权后获得的属性和方法功能更加强大，比如可以使用它们创建或修改VI的代码。

![](images/image432.png)

图 6.33更多的VI属性设置

## 创建VI

使用"新建VI"函数，可以创建出一个新的VI，并得到它的引用。通过设置VI"前面板-\>打开"和"程序框图-\>打开"属性，可以让它的前面板以及程序框图显示出来（图
6.33）。这个程序运行之后，计算机屏幕上会出现一个新建的VI。它的行为与在LabVIEW的菜单中选择"文件-\>新建VI"是相同的。

![](images/image433.png)

图 .33创建新的VI

## 创建新的控件

在创建了空的VI之后，就需要考虑为其添加一些内容了。例如，首先为其添加两个数值控件。创建新的控件使用的是"创建VI对象"函数。给"创建VI对象"函数提供正确的控件类型、控件引用类型、控件位置和新控件的所有者（在这里指新建VI的引用），它就可以在这个VI上创建出一个新的控件。创建新控件的程序框图与所创建出来的前面板可分别参见图
6.34和图 6.35。

![](images/image434.png)

图 .34创建控件

![](images/image435.png)

图 .35运行程序创建出来的VI的前面板

## 创建程序框图

创建程序框图上的节点的方法与在前面板上创建控件的方法是相同的。图
6.36是示例程序的一部分代码，只是省略了程序前面创建新VI的部分。运行它，便在程序框图上创建出一个新的加法函数和一个数值常量。

![](images/image436.png)

图 .36创建一个加法函数和一个数值常量

对于程序框图，除了要创建节点之外，还要把它们用数据线连接起来。连接数据线使用的是接线端的方法"连接数据线"，它可以把两个接线端连接起来。图
6.37所示的程序是把新生成的数值常量和加法函数连线。

![](images/image437.png)

图 .37把常量和加法的输入用数据线连接

其它的接线端也需要被连接起来，整个的程序框图如下所示：包括创建VI、创建控件、创建程序框图上的节点以及对它们连线（图
6.38）。

![](images/image438.png)

图 .38整个程序的框图

运行这个程序，生成的VI的程序框图如图 6.39所示。

![](images/image439.png)

图 .39使用VI Scripting生成的程序框图

需要编程序创建一个新VI的用例不多，除非是需要生成大量的VI。比如，某公司开发硬件驱动程序，需要生成大量面板和程序框图都类似的VI。

## 批量修改VI

在实际应用中，比较常用的是，需要对已有的VI进行某种批量修改。比如，已经编写好了一个由几十个VI组成的一个功能模块。但随后，新的需求要求修改所有VI的某些属性或部分代码，或者修改界面的布局等。这些修改在每个VI中都是相似的，这种情况就非常适合通过编程来修改。

以一个简单的任务为例。当我们需要把自己所写的一批VI发布给用户时，可能需要给这些VI加上密码，以保护产权。要完成这样一个任务，首先要得到所有需要被修改的VI的路径。在这个例子中，我们还是采用最简单的策略，列出一个文件夹下的所有VI。然后一一打开每个VI，通过属性和方法对VI进行修改。在这个例子中，我们使用VI的"锁定状态-\>设置"方法给VI添加密码。修改了VI之后，一定要保存。如果不保存，VI引用被关闭后，所有的修改都会丢失。保存VI使用的是VI的"保存-\>仪器"方法（VI的全称是"虚拟仪器"）。整个任务的代码如图
6.40所示。

![](images/image440.png)

图 .40批量为VI设置密码