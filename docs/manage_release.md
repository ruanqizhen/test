# 发布产品

LabVIEW软件开发结束后，在交给用户时有几种常见的形式。比如，可以把软件的源文件，即开发时使用的VI直接交给用户。用户在LabVIEW环境中打开这些VI就可以执行。如果用户没有LabVIEW开发系统，可以把软件做成EXE可执行文件的形式，交给用户。这样，用户直接双击EXE文件就可以运行软件了。

LabVIEW提供给用户的软件发布工具也集成在项目浏览器中。项目浏览器中的"程序生成规范"就是用来配置项目发布方法的。在程序设置规范的右键菜单中选取"新建"，可以看到程序有六种发布方法（图
9.15），分别是：应用程序、安装程序、共享库、源代码、web服务和zip文件。

![](images/image545.png)

图 .15设置项目发布方法

## 应用程序

### 应用程序生成规范

在程序设置规范的菜单中选择"新建-\>应用程序"，就会弹出图
9.16所示的程序设置规范的属性对话框。"应用程序"设置规范用于生成一个EXE可执行文件。倘若某个项目有一个主VI（一般是程序的主界面），其它所有VI都是它的子VI。那么在"应用程序"属性对话框的源文件属性页中把主VI设置为启动VI即可。LabVIEW会自动把所有主VI静态调用的子VI都加入EXE文件中。

![](images/image546.png)

图 .16应用程序设置

如果项目中有动态调用的子VI，LabVIEW是不会自动把这些子VI加入EXE文件的，必须由开发人员手工把这些VI加入到项目"始终包括"的文件列表中。

### 文件路径的变化

如果在程序中，有动态调用VI，或者有读写某些文件的子VI，那么程序中必然会有关于这些VI或文件的路径信息。在把程序生成为可执行文件后，这些文件的位置和路径常量的值可能会发生变化。这带来了一个问题：在开发状态下运行正常的程序，生成为可执行文件后，也许不能正常运行了。

![](images/image547.png)

图 .17文件路径设置

以图
9.17中的程序为例，其功能是打开一个与当前VI同文件夹的"Data.ini"文件。但是，在把该项目制作成可执行文件后，运行这一可执行文件，就会发现Data.ini并没有被成功读写。为了查看错误是如何产生的，可以对程序稍作改动，让它把当前VI以及Data.ini文件的路径显示在界面上（图
9.18）。

![](images/image548.png)

图 .18在程序界面分别显示出VI和数据文件的路径

为了便于比较，可以把开发环境下的VI所在的文件夹放在"C:\\9.3\\"，而设置生成的应用程序文件命名为TestDir.exe，所在文件夹放置在"C:\\9.3\\应用程序\\"（图
9.19）。

![](images/image549.png)

图 .19设置生成的应用程序的路径和文件名

依次在开发状态下直接运行VI以及运行VI生成的可执行文件，分别观察显示出来的VI和数据文件的路径（图
9.20）。

![](images/image550.png)
![](images/image551.png)

图 .20左图为直接运行VI；右图为运行可执行文件

可以看到，在开发环境下，运行VI，得到的VI路径即真实的VI路径，数据文件与VI在同一文件夹下。但是在生成可执行文件之后，VI文件就不存在了。这时候显示出来的VI路径是一个虚假的路径。它显示VI路径在exe文件的下一层。倘若把exe文件看作是一个"文件夹"，则VI位于这个虚拟的文件夹中。尽管显示出来的数据文件仍然和VI位于同一级，但真实的数据文件显然不可能位于EXE文件"内部"。因此可以肯定，这时使用相对路径运算出来的数据文件的路径是错误的。

这个问题的解决办法有两种。简单的方法是，在编写程序时，始终把主VI放在某一子文件夹下，比如放在一个叫做"C:\\9.3\\MyApp\\"的文件夹下，数据文件也放在与"MyApp"同级的路径下，即文件夹"C:\\9.3\\"下。这样在程序中保存的数据文件的相对路径就是"..\\..\\data.ini"。程序生成EXE文件之后，数据文件与EXE文件在同一路径下，这时该相对路径仍然正确。

另一个更为灵活的解决方法是，在程序中首先判断当前是在开发环境下运行VI呢，还是在运行生成的可执行文件，针对这两种不同的状态分别采用不同的路径运算方法。在上面的例子中，其实是希望数据文件与生成的EXE文件在同一文件夹下。那么，这时只需要再得到VI的更上一层的路径就可以了（图
9.21）。

![](images/image552.png)

图 .21在不同的运行方式下，得到不同的路径

判断当前的运行方式，可以使用"应用程序"的"类别"属性。如果该属性的值为"Run
Time
System"则表示当前正在运行一个EXE文件。需要注意的是，在开发环境下，同一项目中的VI可能在不同的子文件夹中，文件夹可以有多个层次。但是生成可执行文件后，所有的VI都处会在同一级目录中，即以EXE文件作为虚拟文件夹的那个"文件夹"中。VI的路径全部是类似"C:\\xxx\\xxxx.exe\\xxx.vi"的形式。

还有一种更为简单的处理方式，就是干脆把项目中所有的数据文件都放在VI的上一级目录中。这样，程序就不需要做任何处理，在生成EXE文件之后，数据文件正好对应地放置在EXE文件所在的文件夹中。

LabVIEW生成的EXE文件在运行时，都会自动生成一个同名的INI文件，如果程序中有任何需要配置的信息，可以保存这个INI文件中，不必另外再使用一个INI文件。EXE文件的名字是可以改变的，所以在程序中不能使用固定的INI文件名，而是应当根据当前EXE文件的名称来决定INI文件的名称。在程序中使用"应用程序-\>目录路径"和"应用程序-\>名称"两个属性可以得到当前EXE文件的路径和文件名。如图
9.22所示。

![](images/image553.png)

图 .22通过EXE文件名得到INI文件名

LabVIEW有一个路径常量："'VI库'路径常量"![](images/image554.png)。它常被用来定位LabVIEW开发环境自身的路径。比如程序需要读取"LabVIEW.ini"文件中的信息，可以使用图
9.23的方法得到该文件路径。

![](images/image555.png)

图 .23得到LabVIEW.ini文件的路径

若是在LabVIEW开发环境中，'VI库'路径常量表示的是当前LabVIEW安装路径下的vi.lib文件夹所在路径。但是生成可执行文件后，EXE文件的运行就脱离LabVIEW开发环境了。所以程序无法判断电脑上是否有LabVIEW，以及它的位置。"VI库"路径常量将返回空值。

一般来说，在生成EXE文件之后，程序就不应当再依赖LabVIEW开发环境下的任何文件了。但是如果程序中必须得到LabVIEW开发环境所在的文件夹，可通过读取注册表来得到。LabVIEW安装信息写在在注册表中的键值是固定不变的。

### 其它设置

作为专业的应用程序，还需要为其制作一个漂亮的图标，设定版本信息等。这些操作也都可以在程序生成规范中设置。它们的使用方法较为直观，本书就不再复述了。

在真正生成应用程序之前，可以先进入生成规范属性的"预览"页面预览一下。预览页会列出将要生成的所有文件和它们的路径，预览可以帮助编程者在真正生成大量文件前验证生成规范的配置，如所包含的源文件和生成路径等是否正确。

## 共享库

有时候，由LabVIEW编写出来的程序未必是有界面的应用程序，而是一些供其它非LabVIEW编写的程序调用的子函数。在这种应用情形下，最常见的方法就是把LabVIEW项目的VI做成DLL，项目中每个需要供其它程序调用的VI成为DLL中的一个输出函数。

![](images/image556.png)

图 .24配置DLL的导出函数

在程序设置规范的菜单中选择"新建-\>共享库"，在属性对话框源文件页可配置生成共享库。

生成可执行文件只需要选择启动VI就可以了。但是生成共享库DLL文件，一般一个DLL中包含有多个导出函数。项目中，需要在DLL中被使用的VI，都应当被放置在对话框的"导出VI"一栏中。

将项目中的某个VI置入"导出VI"栏，或点击"定义原型"按钮，即可在"定义VI原型"框中配置选中的导出VI（函数）的属性（图
9.24）。VI在转变成DLL函数的时候可能需要做一些手工配置。比如说VI名可以是中文，但函数名必须是英文，所以当VI名中包含有非法的函数名字符时，需要手工更改函数名。函数中参数的名称也有类似问题。

DLL函数的数据类型也与VI的控件数据类型有所差异。比如说字符串，在VI中字符串的长度信息是包含在字符串数据中的，而DLL中函数的字符串通常以char\*类型表示，它不包含长度信息。通常在DLL函数中需要传递字符串的时候，同时还需要用另一个参数表示字符串的长度。

LabVIEW在生成DLL文件的同时，还会生成相应的.h文件和.lib文件，供其它程序调用这个DLL时使用。如果需要把VI制作成DLL中的导出函数，应当尽量采用基础数据类型，比如字符串，数值类型等等。如果VI中使用了复杂类型，比如簇等，在生成的DLL函数中会使用LabVIEW的特殊数据类型，它们会被定义成名为"TD1"、"TD2"等的结构类型。在文本语言中处理这些数据类型是比较麻烦的，必须使用LabVIEW提供的相应的C接口API函数才可以处理它们。所以，为了简化使用LabVIEW生成的DLL的难度，应当尽量使用简单数据类型作为函数参数类型。

## 源代码

### 发布源代码

某些时候，开发人员编写的程序是直接以VI的形式提供给用户的。比如，在LabVIEW众多的工具包中，大多数都是以VI的形式提供的。但是发布给用户的VI与开发时的VI还是有所不同的，最常见的区别包括：为了保护产权，发布给客户的VI有时需要加密码，禁止用户查看其程序框图；为了加快客户应用程序的运行速度，需要禁止VI的调试功能等。使用LabVIEW的源代码发布功能可以便捷地完成以上的修改。

![](images/image557.png)

图 .25设置源文件发布时VI的属性

使用这一功能时，在LabVIEW的程序生成规范中选择"新建-\>源代码发布"。它的配置与共享库相类似，也需要指定哪些VI会最终包含在发布包中。其不同之处是，源代码发布直接把VI提供给用户，不需改变参数信息类型等。但是，源代码发布需要在"源文件设置"页中设置发布给用户的VI的属性。在项目文件列表中选中一个VI，即可以在这个页面右半部份为其设置密码或修改其发布后的文件名。其它更多属性出现在点击"自定义VI属性"按钮后弹出的对话框中（图
9.25）。默认情况下，发布的VI属性都保持原VI属性不变。若需要改变，只需要更改一下属性相应的复选框即可。

为了进一步提高发布给用户的VI的运行效率，以及确保程序框图不被他人所窃看，可以选择移除VI的程序框图和前面板。在LabVIEW
7.1以及之前的版本中，选择VI菜单"文件-\>另存为..."的时候可以选择改变VI的某些属性，以及移除前面板、程序框图等。在LabVIEW
8之后，这些设置都被挪到发布源代码的生成配置规范中来了。在移除VI前面板时需要注意：只有那些从不显示界面的子VI才可以被移除前面板。被移除了程序框图的VI只能工作在特定的LabVIEW版本上。比如，在LabVIEW
8.5上移除了某个VI的程序框图。那么，这个VI今后就只能工作在LabVIEW
8.5上了。而在LabVIEW
8.6或其它版本中是无法使用这个VI的。因此，倘若发布的VI还需要在将来的LabVIEW新版本上继续使用，即便需要保护程序框图，也只是给VI加上密码，而不是移除程序框图。

在发布产品，生成.exe文件时，启动VI栏目中可以包含多个VI。这样生成的EXE，在启动时，会同时打开多个VI的面板。

### 编辑控件选板和函数选板

需要发布源代码的VI一般是一些提供给用户编程时使用的子VI。为了方便用户在编程时选用这些VI，可以把这些VI加入函数选板。

把VI添加到函数选板上，有两种方式。

第一种是自动添加方式。只要把VI放置在\[LabVIEW\]\\user.lib文件夹下，LabVIEW就会在函数选板"用户库"中显示出此VI。用户编程时可以从这里选取使用此VI。user.lib文件夹下，以下横线作为名字开头的文件和文件夹会被LabVIEW忽略，不会被添加到函数选板上。

第二种方式是手工添加VI至函数选板。在菜单中选择"工具-\>高级-\>编辑选板"，这时屏幕上会出现三个对话框，其中一个是控件选板，一个是函数选板，最后一个是控制用的"编辑控件和函数选板"对话框。这时的控件与函数选板不再用于选取控件和函数，而是用于编辑使用。右键点击控件或函数选板上的图标或空白处，会出现编辑选板的菜单。

如果需要把一个VI放置在函数选板某一处，可以选择右键菜单中的"插入-\>VI"。在弹出的"选择需添加的VI或目录"对话框中，输入一个VI的全路径，这个VI就被添加到函数选板上了（图
9.26）。

![](images/image558.png)

图 .26在函数选板上插入VI

编辑好函数选板，在"编辑控件和函数选板"对话框上点击"保存改动"（图
9.27），这时LabVIEW会提示即将做出的改动。控件和函数选板每个子选板的设置被保存在名为.mnu的文件中。点击"继续"就会使刚刚完成的编辑生效。编写程序时，在函数选板上就可以选取刚刚放置上的VI。

![](images/image559.png)

图 .27"编辑控件和函数选板"对话框

大多数情况下，从控件或函数选板上拖拽某个图标至前面板或程序框图，会在程序框图上添加一个控件、函数、子VI或其它节点。但有些选板上的图标可以往程序框图或前面板上添加多个对象，甚至是一段完整的程序。比如，选择函数选板下的"Express-\>执行过程控制-\>While循环"，可以程序框图上添加一个While循环，并在VI前面板上添加一个"停止"按钮控件用于控制这个循环的停止条件。

实现这样的功能非常简单。先写好一个VI，其中包含所有将来打算放置到目标VI上的程序框图和控件。比如实现函数选板"Express-\>执行过程控制-\>While循环"的功能，先要编写一个VI，它有一个While循环和一个"停止"按钮控件用于控制循环的停止条件。把这个VI保存下来，取名"MyWhile.vi"。然后编辑函数选板，把这个VI插入函数选板。保存改动之前，在函数选板上右键点击这个VI，选择"放置VI内容"，然后保存改动（图
9.28）。

![](images/image560.png)

图 .28函数选板上VI的"放置VI内容"选项

以后编程时，从函数选板上拖拽这个VI至程序框图，放置在程序框图上将不是作为子VI的"MyWhile.vi"，而是直接把"MyWhile.vi"中的内容放置在目标VI上。于是目标VI上就多了一个while循环和一个"停止"按钮。

本书在第4章介绍了多种常用的程序结构模式，其中有些模式非常常用，比如循环事件、循环条件等结构。可以为这些结构编写一些模板VI，然后以放置VI内容的方式把它们插入函数选板。这样，再编写程序时，在函数选板上选取这些结构模式的图标，就可以在当前VI上直接添加上这些模式。

## 网络应用

### 远程前面板

有时候，操作人员需要控制在远程计算机上运行的程序。比如，在生产车间的计算机上运行着直接从机床上的传感器上读取数据的程序；而在另一间办公室的监控人员需要实时观察程序读出的数据，并对异常数据做出及时的处理。解决这样的问题可以有多种办法。传统方式是在办公室和生产车间的电脑上各写一个程序，通过TCP/IP等协议，在两台电脑上传递数据。开发这样的程序是比较繁琐的。实际上，LabVIEW提供了几种非常简便的方式，可以轻松控制远程计算机上的程序以及浏览远程计算机上采集的数据。这几种方法的原理是相似的，都是在运行程序或者执行功能的计算机上开设一个web服务。远程的计算机通过web服务得到数据或控制VI的运行。

如果两台电脑都装有同样版本的LabVIEW，那么最方便的远程访问控制方式就是使用远程前面板。

使用远程前面板，首先要打开运行VI的计算机（服务器端）上的web服务功能：从LabVIEW的菜单中选择"工具-\>选项"，在"web服务器：配置"页面中勾选"启用web服务器"。然后把需要被远程使用的VI打开（可以先不运行）。

在远程用于访问的计算机成为客户端。在客户端打开LabVIEW，选择菜单项"操作-\>连接远程前面板"。在弹出的连接远程前面板对话框（图
9.29）中输入开启了web服务的计算机的IP地址、以及需要访问的VI的名称。如果只是观察VI运行的结果，可以不勾选"请求控制"。然后点击"连接"按钮连接服务器上的VI前面板。

![](images/image561.png)

图 .29远程前面板正在进行连接

成功连接后，就会出现web服务器上的VI的前面板，并可以控制它的运行以及观察运行结果（图
9.30）。

![](images/image562.png)

图 .30远程前面板

在web服务器一端，可以使用菜单中的"工具-\>远程前面板管理器"，查看远程前面板的连接情况。如图
9.31所示，这台服务器的"主界面.vi"正在被IP地址为192.168.0.2的机器远程连接。如果希望切断某一远程前面板，可以点击"断开连接客户端"按钮。

![](images/image563.png)

图 .31远程前面板连接管理器

### web发布

使用远程前面板的缺点是服务器和客户端都必须安装相同版本的LabVIEW开发软件。这样，它的使用就受到了一定的限制。实际上，作为客户端，用户并不一定需要使用LabVIEW开发环境的功能。LabVIEW还提供了一种更为通用的web发布功能，可以让一台计算机像浏览网页一样查看和控制运行在另一台计算机上的VI。

在运行VI的计算机（服务器）上，选择LabVIEW菜单"工具-\>web发布工具"。在弹出的web发布工具的配置对话框（图
9.32）上选取需要发布的VI，并启动web服务器。然后按照提示，一步一步生成一个web发布的VI。

![](images/image564.png)

图 .32 web发布工具

LabVIEW会为这个VI生成一个html文件，放置在web服务器的根目录下。web服务器的根目录在LabVIEW的选项中配置，默认路径为\[LabVIEW\]\\www。

只要网络上的其它计算机打开网页浏览器，输入作为web服务器的计算机名或IP地址，即可看到LabVIEW的web服务页面。将需要被访问的VI在web服务器计算机中装入内存，在另一台计算机网页浏览器地址栏的IP地址的后面加上斜杠和刚刚生成的html文件的名称，即可访问和控制刚刚被选中的VI（图
9.33）。

![](images/image565.png)

图 .33通过网页访问VI

### web服务

web服务与web发布之间的关系有些类似共享文件与应用程序之间的关系。通过web发布提供给用户的是一个带有界面的应用程序，用户可以在其它计算机上访问这一应用程序。而web服务并不提供用户完整的应用程序，它只是把一些VI的功能提供出来。这样，运行在其它计算机上的应用程序可以直接利用web服务提供的功能。

web服务提供出来的功能是运行在服务器上的。在使用web服务时，客户机把需要调用的功能、所需的参数传递给服务器，服务器对其进行处理后把运行功能得到的结果再返回给客户机。

在程序设置规范的菜单中选择"新建-\>web服务"，在属性对话框的源文件页，可配置生成服务VI。

## 安装程序

![](images/image566.png)

图 .34配置安装程序

生成应用程序和共享库之后，也许不能直接拿到其它计算机上使用。LabVIEW生成的程序必须依赖LabVIEW运行引擎才可以使用，但很多计算机上可能并没有安装LabVIEW运行引擎。专业的软件通常会带有一个安装包，以帮助用户把软件的各个组成部分放置在目标机器正确的文件夹下，并生成启动菜单、完成写入注册表信息等等。

如果需要制作一个功能非常复杂的安装软件，必须依赖专业的安装包制作工具。但是，如果仅仅需要完成一些最基本的工作，比如创建启动项、在"添加或删除程序"工具中添加一个卸载项目等，使用LabVIEW的程序生成规范中就可以制作了。

在LabVIEW的程序生成规范中选择"新建-\>安装程序"。然后在属性对话框的"源文件"页面选择需要安装至目标机器的文件（图
9.34）。被安装的目标机器上的文件可以是项目中的某个VI，但更常见的情况是需要安装生成好的应用程序、共享库、源代码或者是web服务。因此，也可选择项目中其它生成规范生成的文件。

![](images/image567.png)

图 .35选择需要安装的运行引擎

LabVIEW程序的运行需要依赖LabVIEW运行引擎。为了在没有LabVIEW运行引擎的目标机器上也能运行安装好的LabVIEW程序，可以在"附加安装程序"中选取需要附带的引擎及其他组件（图
9.35）。LabVIEW的引擎是比较大的，它可能会使你的安装包增加几十兆字节的空间。有时候，要发布的程序本身非常小，携带一个比它自身大几十倍的附加内容似乎并不划算。因此，如果能够确保目标机器有所需要的组件，不在安装包里携带运行引擎也是可以的。

## 压缩包

现在网上流行绿色软件。也就是不再为程序制作安装包，而是直接把所需的所有文件打包成一个压缩文件。LabVIEW同样具有此功能。在生成规范中选择生成压缩包，然后把所需文件加入压缩包即可。

## 打包库

许多使用LabVIEW的工程师也使用过Visual Studio这个开发工具。使用Visual
Studio时，通常可以为一个软件产品创建一个Solution，一个Solution可以包含多个Project。这个软件产品可能由多个文件组成，比如说有一个EXE，两个DLL组成，那么就可以为它们创建三个Project。每个Project的源代码都是独立的，可以设置Project的编译方法。这样便于独立地分别开发每个Project。各个Project之间是可以有依赖关系的。比如说，编译EXE的时候可以自动地把另外两个DLL先编译一遍。

而LabVIEW的"项目"这个概念是最近几年才有的，这方面的功能远没有Visual
Studio成熟。在LabVIEW中，只有Project这一级，而没有Solution。这在开发大型程序时，可能会带来一些不便：所有的VI都只能放在一个Project中，最终生成的可执行文件是一个比较大的EXE文件，每次编译都要编译项目中所有的文件，很耗时；更为严重的问题是很难划分可独立开发的程序模块，所有代码都混在一起，不容易分别开发。

有些公司发布的产品不是可执行文件而是一个供其它程序调用的功能库。如果以VI的形式发布一个功能模块，这些VI源程序就必然被放置到用户的工程中去，这很不合理；如果以DLL文件的形式发布，在LabVIEW中调用DLL又很麻烦。

这个问题一直到 LabVIEW 2010 发布后才有所改善。LabVIEW 2010
增加了一种新的文件格式：打包库（英文：Packed Project
Libraries，文件名后缀：lvlibp)。这种文件格式兼有原来库文件（lvlib文件）和LLB文件格式的一些优点，在模块化程序的时候，可以考虑使用Packed
Project Libraries 。

打包库从名字上来看，就是被包装好了的库文件。
库是编程时候由程序员创建出来的。比如图9.36所示的这个工程，创建了一个叫做"My
Algorithm Library.lvlib"的库。它包含两个VI，其中一个是私有的。

![](images/image568.png)\
图9.36 用于生成打包库的项目

而打包库则是通过一个项目的生成规范，从库编译而来的。比如图9.36所示的项目，鼠标右击"程序生成规范"，可以选择新建一个"打包库"类型的生成规范。在这个生成规范中指定把"My
Algorithm Library.lvlib"编译成打包库（图9.37）。

![](images/image569.png)\
图9.37 选择打包库中的内容

编译的结果是在指定的路径下生成了一个名为"My Algorithm
Library.lvlibp"的文件。它的后缀名仅比库文件多了一个字母p。

双击这个文件，可以打开它，看到它里面包含的公有VI（图9.38）。

![](images/image570.png)\
图9.38 查看Packed Project Library中的内容

如果需要在其它项目中使用到这个打包库，可以直接把它加到另一个项目中去。如图9.39是一个演示项目。

![](images/image571.png)\
图9.39 使用Packed Project Library

从使用者角度来看，打包库看上去和库非常相似，用法也完全相同。

打包库与库

- 都是将功能相关的一组VI封装起来的方法；
- 库中的VI可以具有层次结构；
- 库中的VI都带有名字空间，名字空间是带有后缀名的库名；
- 都可以方便地放在项目管理器里使用。

尽管它们十分相似，打包库与库相比，还是有一些明显区别的：

- 打包库是通过编译生成的；
- 打包库中的VI是编译后产生的，它们不能被修改；
- 打包库包含有私有VI，但用户无法看到也不能使用它们；
- 打包库把VI，.lvlib以及其它用到的文件都打成一个压缩包，用户在磁盘上就只能看到一个.lvlibp文件，看不到VI文件；
- 打包库很适合作为最终产品发布给用户使用；
- 在项目中使用打包库可以缩短编译时间，因为打包库中的VI是已编译好的，不需要再随项目编译一遍。这也要求打包库与使用打包库的项目是在同一版本的LabVIEW下编译的。
